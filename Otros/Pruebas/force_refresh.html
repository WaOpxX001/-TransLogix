<!DOCTYPE html>
<html>
<head>
    <title>Forzar Actualizaci√≥n - TransLogix</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        .btn { padding: 10px 20px; margin: 10px; background: #007bff; color: white; text-decoration: none; border-radius: 5px; display: inline-block; }
        .btn:hover { background: #0056b3; }
        .status { padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÑ Forzar Actualizaci√≥n Dashboard</h1>
        
        <div class="status info">
            <h3>Pasos para forzar actualizaci√≥n:</h3>
            <ol>
                <li>Presiona <strong>Ctrl + Shift + Delete</strong></li>
                <li>Selecciona "Todo el tiempo"</li>
                <li>Marca "Im√°genes y archivos en cach√©"</li>
                <li>Haz clic en "Borrar datos"</li>
            </ol>
        </div>
        
        <div id="api-test" class="status">
            <h3>üîç Probando API...</h3>
            <p id="api-result">Verificando...</p>
        </div>
        
        <div class="status">
            <h3>üöÄ Opciones de Actualizaci√≥n:</h3>
            <a href="index.html?v=1731812392" class="btn">Dashboard con Cache Busting</a>
            <a href="javascript:location.reload(true)" class="btn">Recarga Forzada</a>
            <a href="javascript:clearAllCache()" class="btn">Limpiar Todo el Cache</a>
        </div>
        
        <div id="debug-info" class="status">
            <h3>üìä Informaci√≥n de Debug:</h3>
            <pre id="debug-content">Cargando...</pre>
        </div>
    </div>

    <script>
        // Limpiar todo el cache
        function clearAllCache() {
            localStorage.clear();
            sessionStorage.clear();
            
            // Limpiar cache de service workers si existen
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(function(registrations) {
                    for(let registration of registrations) {
                        registration.unregister();
                    }
                });
            }
            
            // Limpiar cache del navegador
            if ('caches' in window) {
                caches.keys().then(function(names) {
                    for (let name of names) {
                        caches.delete(name);
                    }
                });
            }
            
            alert('Cache limpiado. Recargando p√°gina...');
            setTimeout(() => {
                window.location.href = 'index.html?v=' + Date.now();
            }, 1000);
        }

        // Probar API
        fetch('/LogisticaFinal/api/dashboard/data_simple_pdo.php?v=' + Date.now())
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                document.getElementById('api-result').innerHTML = `
                    ‚úÖ API funcionando correctamente<br>
                    üí∞ Gastos totales: $${data.expenses?.total_amount || 0}<br>
                    ‚úÖ Gastos aprobados: $${data.expenses?.monto_aprobados || 0}<br>
                    ‚ùå Gastos rechazados: $${data.expenses?.monto_rechazados || 0}<br>
                    üìä Categor√≠as: ${Object.keys(data.expensesByCategory || {}).join(', ')}
                `;
                document.getElementById('api-test').className = 'status success';
                
                document.getElementById('debug-content').textContent = JSON.stringify(data, null, 2);
            })
            .catch(error => {
                document.getElementById('api-result').innerHTML = `‚ùå Error: ${error.message}`;
                document.getElementById('api-test').className = 'status error';
                document.getElementById('debug-content').textContent = `Error: ${error.message}`;
            });
    </script>
</body>
</html>
